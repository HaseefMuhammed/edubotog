<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EB GENIE</title>
    <link rel="stylesheet" href="style2.css">
    <link rel="icon" href="images/icon.png" type="image/logo">
    <script src="https://kit.fontawesome.com/3945bc0b8d.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="bootstrap.css">
    <style>
      /* Global UI scale variable: change --ui-scale between 0.7 and 1.3 to shrink/enlarge UI */
      :root {
        --ui-scale: 1;
      }

      /* Scale rem-based sizes by changing root font-size */
      html {
        font-size: calc(16px * var(--ui-scale));
      }

      /* Optimized Premium UI with Reduced Animations */
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background: linear-gradient(135deg,
    #667eea 0%,
    #764ba2 25%,
    #f093fb 50%,
    #4facfe 75%,
    #00f2fe 100%);
  background-size: 400% 400%;
  /* Slower, less intensive animation */
  animation: gradientShift 30s ease infinite;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
  color: #1a202c;
  position: relative;
  overflow-x: hidden;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Simplified Background Elements - Reduced from 8 to 4 */
.glass-bg {
  display: block !important;
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 1;
  pointer-events: none;
  overflow: hidden;
}

/* Override some fixed pixel sizes to respect the UI scale */
.icon-glow {
  width: calc(110px * var(--ui-scale)) !important;
  height: calc(110px * var(--ui-scale)) !important;
  padding: calc(1.2rem * var(--ui-scale)) !important;
  border-width: calc(3px * var(--ui-scale)) !important;
}

body::before {
  width: calc(600px * var(--ui-scale));
  height: calc(600px * var(--ui-scale));
  top: calc(-200px * var(--ui-scale));
  right: calc(-200px * var(--ui-scale));
}

body::after {
  width: calc(500px * var(--ui-scale));
  height: calc(500px * var(--ui-scale));
  bottom: calc(-150px * var(--ui-scale));
  left: calc(-150px * var(--ui-scale));
}

/* Reduced floating elements - only 4 instead of 8 */
.floating-element {
  position: absolute;
  font-size: 3rem;
  opacity: 0.15;
  /* Slower animation */
  animation: float-random 25s infinite ease-in-out;
  color: white;
  text-shadow: 0 0 20px rgba(255, 255, 255, 0.6);
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
  /* Improve performance */
  will-change: transform;
}

.floating-element:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; animation-duration: 22s; font-size: 3.5rem; }
.floating-element:nth-child(2) { left: 80%; top: 30%; animation-delay: 3s; animation-duration: 26s; font-size: 2.8rem; }
.floating-element:nth-child(3) { left: 50%; top: 50%; animation-delay: 6s; animation-duration: 24s; font-size: 3.2rem; }
.floating-element:nth-child(4) { left: 20%; top: 70%; animation-delay: 2s; animation-duration: 23s; font-size: 2.5rem; }

/* Simplified animation - less transformation */
@keyframes float-random {
  0%, 100% {
    transform: translateY(0px) translateX(0px);
    opacity: 0.15;
  }
  50% {
    transform: translateY(-50px) translateX(20px);
    opacity: 0.2;
  }
}

/* Simplified reflection - static instead of animated */
.glass-reflection {
  display: block !important;
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 1;
  pointer-events: none;
  background:
    radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.12) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.08) 0%, transparent 60%);
  /* Animation removed for better performance */
}

/* Simplified shape animations */
body::before,
body::after {
  content: '';
  position: fixed;
  z-index: 0;
  pointer-events: none;
}

body::before {
  width: 600px;
  height: 600px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(240, 147, 251, 0.12) 0%, transparent 70%);
  top: -200px;
  right: -200px;
  /* Slower animation */
  animation: floatShape1 25s ease-in-out infinite;
}

body::after {
  width: 500px;
  height: 500px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(79, 172, 254, 0.12) 0%, transparent 70%);
  bottom: -150px;
  left: -150px;
  /* Slower animation */
  animation: floatShape2 23s ease-in-out infinite;
}

@keyframes floatShape1 {
  0%, 100% {
    transform: translate(0, 0);
  }
  50% {
    transform: translate(-30px, 30px);
  }
}

@keyframes floatShape2 {
  0%, 100% {
    transform: translate(0, 0);
  }
  50% {
    transform: translate(30px, -30px);
  }
}

/* Main Container with Premium Glassmorphism */
.container {
  max-width: 850px;
  margin: 110px auto 50px auto;
  padding: 3rem 3rem 3.5rem 3rem;
  border-radius: 24px;
  background: linear-gradient(135deg,
    rgba(255, 255, 255, 0.35) 0%,
    rgba(255, 255, 255, 0.25) 100%);
  backdrop-filter: blur(30px);
  -webkit-backdrop-filter: blur(30px);
  box-shadow:
    0 8px 32px rgba(31, 38, 135, 0.15),
    0 20px 60px rgba(0, 0, 0, 0.12),
    inset 0 0 0 1px rgba(255, 255, 255, 0.4),
    inset 0 -2px 20px rgba(255, 255, 255, 0.2);
  text-align: center;
  position: relative;
  z-index: 2;
  border: 1px solid rgba(255, 255, 255, 0.4);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
}

/* Removed shimmer animation for better performance */

.container:hover {
  transform: translateY(-4px);
  box-shadow:
    0 12px 40px rgba(31, 38, 135, 0.18),
    0 25px 70px rgba(0, 0, 0, 0.13),
    inset 0 0 0 1px rgba(255, 255, 255, 0.5),
    inset 0 -2px 20px rgba(255, 255, 255, 0.3);
}

/* Navigation Bar with Premium Glassmorphism */
nav.glassmorphism {
  background: linear-gradient(135deg,
    rgba(255, 255, 255, 0.25) 0%,
    rgba(255, 255, 255, 0.18) 100%) !important;
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.4);
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.08),
    inset 0 -1px 0 rgba(255, 255, 255, 0.3);
  border-radius: 0;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.2rem 2rem;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  width: 100%;
}

nav.glassmorphism::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 90%;
  height: 1px;
  background: linear-gradient(90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.4) 50%,
    transparent 100%);
}

nav h4 {
  letter-spacing: 1px;
  font-weight: 700;
  font-size: 1.35rem;
  color: #ffffff;
  text-shadow:
    0 2px 8px rgba(0, 0, 0, 0.3),
    0 0 20px rgba(255, 255, 255, 0.3);
  margin: 0;
  flex: 1;
  display: flex;
  align-items: center;
  /* Removed glow animation */
}

/* Language Switch Styles */
.language-switch {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  position: relative;
}

.language-switch span {
  font-size: 0.875rem;
  font-weight: 700;
  color: #ffffff;
  text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
  letter-spacing: 0.5px;
}

.switch {
  position: relative;
  display: inline-block;
  width: 56px;
  height: 30px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25));
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 34px;
  border: 1.5px solid rgba(255, 255, 255, 0.5);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
}

.slider:before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 3px;
  bottom: 3px;
  background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 50%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2), 0 0 4px rgba(255, 255, 255, 0.5);
}

input:checked + .slider {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0.35));
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.15), 0 0 12px rgba(255, 255, 255, 0.3);
}

input:checked + .slider:before {
  transform: translateX(26px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25), 0 0 8px rgba(255, 255, 255, 0.6);
}

/* Icon Styling with Simplified Effects */
.icon-glow {
  border-radius: 50%;
  margin-bottom: 2rem;
  width: 110px;
  height: 110px;
  object-fit: cover;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.5) 0%, rgba(255, 255, 255, 0.3) 100%);
  backdrop-filter: blur(15px);
  padding: 1.2rem;
  border: 3px solid rgba(255, 255, 255, 0.6);
  box-shadow:
    0 12px 35px rgba(0, 0, 0, 0.15),
    0 0 0 8px rgba(255, 255, 255, 0.1),
    inset 0 -4px 12px rgba(255, 255, 255, 0.3);
  /* Slower, simpler animation */
  animation: iconFloat 5s ease-in-out infinite;
  position: relative;
}

/* Removed rotating pseudo-element for better performance */

@keyframes iconFloat {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* Main Title with Simplified Glow */
h1 {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  font-size: 2.5rem;
  font-weight: 800;
  letter-spacing: 0.5px;
  color: #ffffff;
  text-shadow:
    0 2px 12px rgba(0, 0, 0, 0.4),
    0 0 30px rgba(255, 255, 255, 0.4);
  margin-bottom: 2rem;
  /* Removed pulse animation */
  position: relative;
}

/* Response Text Area with Premium Style */
#responseText {
  font-size: 1.05rem;
  color: #1e293b;
  white-space: pre-wrap;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.7) 0%, rgba(255, 255, 255, 0.6) 100%);
  backdrop-filter: blur(15px);
  border-radius: 16px;
  padding: 2rem;
  margin-top: 2rem;
  border: 1.5px solid rgba(255, 255, 255, 0.5);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  line-height: 1.8;
  text-align: left;
  min-height: 80px;
  box-shadow:
    0 8px 24px rgba(0, 0, 0, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.5);
}

#responseText:empty {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.3) 100%);
  text-align: center;
  color: #ffffff;
  text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
  font-weight: 500;
}

#responseText:not(:empty) {
  animation: contentFadeIn 0.4s ease-out;
}

@keyframes contentFadeIn {
  from {
    opacity: 0;
    transform: translateY(5px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Beautiful Buttons */
button, .btn {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.3) 100%);
  color: #fff;
  border: 1.5px solid rgba(255, 255, 255, 0.5);
  backdrop-filter: blur(12px);
  border-radius: 14px;
  padding: 0.85rem 2.5rem;
  font-size: 1.05rem;
  font-weight: 700;
  box-shadow:
    0 6px 20px rgba(0, 0, 0, 0.12),
    inset 0 1px 0 rgba(255, 255, 255, 0.4);
  margin: 0.5rem 0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  outline: none;
  cursor: pointer;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
}

/* Removed ripple effect for better performance */

button:hover, .btn:hover {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.5) 0%, rgba(255, 255, 255, 0.4) 100%);
  box-shadow:
    0 10px 30px rgba(0, 0, 0, 0.18),
    inset 0 1px 0 rgba(255, 255, 255, 0.5);
  transform: translateY(-2px);
}

button:active, .btn:active {
  transform: translateY(0px);
}

/* Dialog with Premium Glassmorphism */
dialog {
  border-radius: 20px;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
  backdrop-filter: blur(30px);
  box-shadow:
    0 12px 48px rgba(0, 0, 0, 0.25),
    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
  border: 1.5px solid rgba(255, 255, 255, 0.4);
  color: #334155;
  font-size: 1.05rem;
  padding: 2.5rem;
  z-index: 20;
  max-width: 450px;
}

dialog::backdrop {
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(8px);
}

dialog button {
  margin-top: 2rem;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.95) 0%, rgba(118, 75, 162, 0.95) 100%);
  color: #fff;
  border-radius: 12px;
  font-size: 1.05rem;
  font-weight: 700;
  text-align: center;
  margin-left: auto;
  margin-right: auto;
  display: block;
  padding: 0.85rem 2.5rem;
  border: 1.5px solid rgba(255, 255, 255, 0.3);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

dialog button:hover {
  background: linear-gradient(135deg, rgba(118, 75, 162, 0.95) 0%, rgba(102, 126, 234, 0.95) 100%);
  box-shadow: 0 8px 28px rgba(102, 126, 234, 0.5);
}

dialog p {
  line-height: 1.7;
  margin: 0;
  font-weight: 500;
}

/* Status Indicator with Simplified Glow */
.status-indicator {
  display: inline-block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #10b981;
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
  /* Slower animation */
  animation: statusPulse 3s infinite;
  margin-left: 0.5rem;
}

@keyframes statusPulse {
  0%, 100% {
    opacity: 1;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
  }
  50% {
    opacity: 0.9;
    box-shadow: 0 0 0 5px rgba(16, 185, 129, 0.2);
  }
}

/* Back Arrow Styling */
.tap {
  transition: all 0.3s ease;
  color: #ffffff !important;
  padding: 0.5rem;
  border-radius: 8px;
}

.tap:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateX(-3px);
}

.tap i {
  color: #ffffff !important;
  filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
}

/* Responsive Design */
@media (max-width: 700px) {
  .container {
    max-width: 95vw;
    padding: 2rem 1.5rem;
    margin: 90px auto 25px auto;
  }

  h1 {
    font-size: 1.8rem;
  }

  .icon-glow {
    width: 85px;
    height: 85px;
  }

  nav {
    padding: 1rem 1rem !important;
  }

  nav h4 {
    font-size: 1.15rem;
  }

  .language-switch span {
    font-size: 0.75rem;
  }

  .switch {
    width: 50px;
    height: 26px;
  }

  .slider:before {
    height: 18px;
    width: 18px;
  }

  input:checked + .slider:before {
    transform: translateX(24px);
  }

  .floating-element {
    font-size: 2rem;
    opacity: 0.1;
  }

  /* Hide half of floating elements on mobile */
  .floating-element:nth-child(3),
  .floating-element:nth-child(4) {
    display: none;
  }

  #responseText {
    padding: 1.5rem;
    font-size: 1rem;
  }

  button, .btn {
    padding: 0.75rem 2rem;
    font-size: 1rem;
  }
}
    </style>
</head>
<body class="bg-dark">
      <!-- All rights resieved from FLOWWAY PUBLICATIONS
  THIS IS UNDER LICENSE TO KNOW ABOUT LICENCE PLEASE VISIT WWW.WEBCRAAFT.42WEB.IO/CONTACT
  IF YOU ARE MAKING COPY OF THE ORGINAL ONE YOU MIGHT RESIEVE COPYWRITE AND WE WILL MAKE A COMPLAINT ON COURT.

  -----TO GET LICENSE PLEASE VISIT WWW.WEBCRAAFT.42WEB.IO-----------

  ------------

  IF YOU WANT AN OPERATING SYSTEM PLEASE VISIT WWW.WEBCRAAFT.42WEB.IO /OR/ HASEEF-WS.NETLIFY.APP

  LICENSE NO :  HW-FL-MB-001-2024
  ¬©2024


  ----- Dont use this operationg system without lisence-----
  copyright 2024 Haseef Muhammed
  Web Craft and Any Time Services
  Library FLowwaypc
  css library: Haseef Swift language
  Server Git Hub
  This website already hosted on netlify inc
  -->

     <!-- Reduced Animated Educational Background Elements (4 instead of 8) -->
     <div class="glass-bg">
         <div class="floating-element">üìö</div>
         <div class="floating-element">üéì</div>
         <div class="floating-element">‚úèÔ∏è</div>
         <div class="floating-element">üí°</div>
     </div>
     <div class="glass-reflection"></div>

     <!-- Preloader -->
     <div id="preloader">
    </div>


<header>
    <nav class="fixed-top glassmorphism">
        <div style="display: flex; align-items: center;">
            <a id="tap" onclick="audio.play()" class="tap" href="home.html" style="text-decoration: none; margin-right: 1rem;">
                <i class="fa-solid fa-arrow-left" style="color: #667eea; font-size: 1.2rem;"></i>
            </a>
            <h4>EB ASSISTANT <span class="status-indicator"></span></h4>
        </div>
        <div class="language-switch">
            <span id="langLabel">EN</span>
            <label class="switch">
                <input type="checkbox" id="languageToggle">
                <span class="slider"></span>
            </label>
            <span id="langLabelMal">ML</span>
        </div>
    </nav>
</header>
<div class="p-3"></div>
<section class="mt-5">
  <dialog id="instructionDialog">
    <button autofocus id="closeDialogBtn">Close</button>
    <p id="dialogText">Say "Hey Teacher" to start asking questions in English, or say "‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡µº" to ask in Malayalam.</p>
  </dialog>

<div class="container">
    <img src="images/icon.png" alt="" class="icon-glow">
    <h1 id="mainTitle">EDU BOT ASSISTANT</h1>
    <div id="response">
        <p id="responseText">Say "Hey Teacher" to start...</p>
    </div>
</div>
</section>




    
    <script src="preload.js"></script>
    <script src="script.js"></script>
   <script src="bootstrap.js"></script>
 
<!-- UI Size control (adjusts --ui-scale) -->
<div id="sizeControl" title="Adjust UI size" style="position:fixed;right:12px;bottom:12px;z-index:2000;background:linear-gradient(135deg, rgba(0,0,0,0.25), rgba(255,255,255,0.02));backdrop-filter:blur(6px);padding:8px 10px;border-radius:10px;color:#fff;font-family:inherit;box-shadow:0 6px 18px rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.06);">
  <label style="display:flex;align-items:center;gap:8px;font-size:0.9rem;">
    <span style="font-weight:700;min-width:40px;">Size</span>
    <input id="scaleRange" type="range" min="0.7" max="1.3" step="0.01" value="1" style="width:130px;">
    <span id="scaleValue" style="min-width:36px;text-align:right;font-weight:700;">100%</span>
  </label>
</div>

<script>
  // Wire up size slider to update the --ui-scale CSS variable
  (function(){
    const range = document.getElementById('scaleRange');
    const valueLabel = document.getElementById('scaleValue');
    const setScale = (v) => {
      const val = Number(v);
      document.documentElement.style.setProperty('--ui-scale', val);
      valueLabel.textContent = Math.round(val * 100) + '%';
    };
    range.addEventListener('input', (e) => setScale(e.target.value));
    // initialize
    setScale(range.value);
  })();
</script>
<script>
const apiKey = 'AIzaSyBP1fH22QrUpqCs-db6PUppWTfvCHFcGcY'; // Your actual API key
const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models';
const MODEL_NAME = 'gemini-2.5-flash-lite'; // More stable model
const endpoint = `${GEMINI_API_URL}/${MODEL_NAME}:generateContent?key=${apiKey}`;

window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.continuous = true;
recognition.interimResults = false;

let isRecognitionRunning = false;
let currentLanguage = 'en-US';
let isMalayalam = false;

// Language Toggle
const languageToggle = document.getElementById('languageToggle');
const mainTitle = document.getElementById('mainTitle');
const responseText = document.getElementById('responseText');
const dialogText = document.getElementById('dialogText');

languageToggle.addEventListener('change', function() {
    isMalayalam = this.checked;
    
    if (isMalayalam) {
        currentLanguage = 'ml-IN';
        mainTitle.textContent = '‡¥é‡¥°‡µç‡¥Ø‡µÅ ‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥Ö‡¥∏‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡¥®‡µç‡¥±‡µç';
        responseText.textContent = '‡¥Ü‡¥∞‡¥Ç‡¥≠‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª "‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡µº" ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥±‡¥Ø‡µÇ...';
        dialogText.textContent = '"‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡µº" ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥±‡¥û‡µç‡¥û‡µç ‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥ô‡µç‡¥ô‡µæ ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÇ.';
    } else {
        currentLanguage = 'en-US';
        mainTitle.textContent = 'EDU BOT ASSISTANT';
        responseText.textContent = 'Say "Hey Teacher" to start...';
        dialogText.textContent = 'Say "Hey Teacher" to start asking questions in English, or say "‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡µº" to ask in Malayalam.';
    }
    
    if (isRecognitionRunning) {
        recognition.stop();
        isRecognitionRunning = false;
        setTimeout(() => {
            recognition.lang = currentLanguage;
            startRecognition();
        }, 500);
    } else {
        recognition.lang = currentLanguage;
    }
});

recognition.lang = currentLanguage;

const predefinedResponses = {
    "what is your name": "My name is Edu Bot AI.",
    "who is your developer": "Haseef Muhammed is my developer. You can visit his website at haseef-ws.netlify.app.",
    "who made you": "Made by Haseef, Agney, Archith, and Niranjan.",
    "where are you from": "I belong to P.M.S.A.P.T.H.S.S Kakkove ATL Lab.",
    "who are you": "I am Edu Bot AI, your intelligent teacher and assistant.",
    "what is ai": "AI stands for Artificial Intelligence, the simulation of human intelligence in machines.",
    "what is artificial intelligence": "Artificial Intelligence is the ability of a computer system to think, learn, and make decisions like humans.",
    "who is your designer": "Agney. A. is a multifaceted talent, excelling as a singer, designer, and technician. With a passion for music, Agney A delivers captivating performances that resonate with audiences. His design skills and technical expertise complement his artistic endeavors, creating a unique blend of creativity and precision.",
    "please welcome": "Namaskaram ellavarkkum. I am Edu Bot AI, your AI Teacher. It is a moment of great pride and joy to welcome Shreemathi K Binumol, the Honorable District Panchayath President of Palakkad, to our school's Science Fair and YIP 7.0 State Winners Exhibition. We are truly honored by your presence, Madam. Your support and encouragement always inspire students to dream bigger and reach higher. On behalf of all teachers and students, I extend a warm and respectful welcome to you, Madam. Thank you.",
    "welcome": "Namaskaram ellavarkkum. I am Edu Bot AI, your AI Teacher. It is a moment of great pride and joy to welcome Shreemathi K Binumol, the Honorable District Panchayath President of Palakkad, to our school's Science Fair and YIP 7.0 State Winners Exhibition. We are truly honored by your presence, Madam. Your support and encouragement always inspire students to dream bigger and reach higher. On behalf of all teachers and students, I extend a warm and respectful welcome to you, Madam. Thank you.",
    "who is the president of india": "The President of India is Droupadi Murmu.",
    "what is the capital of india": "The capital of India is New Delhi.",
    "who is the father of our nation": "Mahatma Gandhi is known as the Father of our Nation.",
    "which is the largest planet in the solar system": "Jupiter is the largest planet in our solar system.",
    "which is the national animal of india": "The national animal of India is the Bengal Tiger.",
    "who wrote the national anthem of india": "The national anthem of India, 'Jana Gana Mana', was written by Rabindranath Tagore.",
    "which is the longest river in the world": "The Nile River is the longest river in the world.",
    "which planet is known as the red planet": "Mars is known as the Red Planet.",
    "who invented the light bulb": "The light bulb was invented by Thomas Alva Edison.",
    "which is the national bird of india": "The national bird of India is the Peacock.",
    "who is the most beautiful person in the world": "The most beautiful person in the world? Definitely Niranjan ‚Äî the 4th std kid-fearing game developer. Then there's Agney, our designer who thinks Canva is Photoshop. And of course APK, the new designer still making 3d printer to lamborgini car."
};

const malayalamResponses = {
    "‡¥®‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥™‡µá‡¥∞‡µç ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç": "‡¥é‡¥®‡µç‡¥±‡µÜ ‡¥™‡µá‡¥∞‡µç ‡¥é‡¥°‡µç‡¥Ø‡µÇ ‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥é.‡¥ê ‡¥Ü‡¥£‡µç.",
    "‡¥®‡¥ø‡¥®‡µç‡¥®‡µÜ ‡¥®‡¥ø‡µº‡¥Æ‡µç‡¥Æ‡¥ø‡¥ö‡µç‡¥ö‡¥§‡µç ‡¥Ü‡¥∞‡¥æ‡¥£‡µç": "‡¥é‡¥®‡µç‡¥®‡µÜ ‡¥®‡¥ø‡µº‡¥Æ‡µç‡¥Æ‡¥ø‡¥ö‡µç‡¥ö‡¥§‡µç ‡¥π‡¥∏‡µÄ‡¥´‡µç, ‡¥Ö‡¥ó‡µç‚Äå‡¥®‡¥ø, ‡¥Ü‡µº‡¥ö‡¥ø‡¥§‡µç, ‡¥®‡¥ø‡¥∞‡¥û‡µç‡¥ú‡µª ‡¥é‡¥®‡µç‡¥®‡¥ø‡¥µ‡µº ‡¥ö‡µá‡µº‡¥®‡µç‡¥®‡¥æ‡¥£‡µç.",
    "‡¥®‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥°‡µÜ‡¥µ‡¥≤‡¥™‡µç‡¥™‡µº ‡¥Ü‡¥∞‡¥æ‡¥£‡µç": "‡¥é‡¥®‡µç‡¥±‡µÜ ‡¥°‡µÜ‡¥µ‡¥≤‡¥™‡µç‡¥™‡µº ‡¥π‡¥∏‡µÄ‡¥´‡µç ‡¥Æ‡µÅ‡¥π‡¥Æ‡µç‡¥Æ‡¥¶‡µç ‡¥Ü‡¥£‡µç. ‡¥Ö‡¥¶‡µç‡¥¶‡µá‡¥π‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥µ‡µÜ‡¥¨‡µç‡¥∏‡µà‡¥±‡µç‡¥±‡µç haseef-ws.netlify.app ‡¥Ü‡¥£‡µç.",
    "‡¥®‡µÄ ‡¥é‡¥µ‡¥ø‡¥ü‡µÜ‡¥Ø‡¥æ‡¥£‡µç ‡¥®‡¥ø‡¥®‡µç‡¥®‡¥§‡µç": "‡¥û‡¥æ‡µª ‡¥™‡¥ø.‡¥é‡¥Ç.‡¥é‡¥∏‡µç.‡¥é.‡¥™‡¥ø.‡¥ü‡¥ø.‡¥é‡¥ö‡µç‡¥ö‡µç.‡¥é‡¥∏‡µç.‡¥é‡¥∏‡µç ‡¥ï‡¥æ‡¥ï‡µç‡¥ï‡µã‡¥µ‡¥ø‡¥≤‡µÜ ATL ‡¥≤‡¥æ‡¥¨‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡¥æ‡¥£‡µç.",
    "‡¥®‡µÄ ‡¥Ü‡¥∞‡¥æ‡¥£‡µç": "‡¥û‡¥æ‡µª ‡¥é‡¥°‡µç‡¥Ø‡µÇ ‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥é.‡¥ê ‡¥Ü‡¥£‡µç ‚Äî ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥¨‡µÅ‡¥¶‡µç‡¥ß‡¥ø‡¥Æ‡¥æ‡¥®‡¥æ‡¥Ø ‡¥Ö‡¥ß‡µç‡¥Ø‡¥æ‡¥™‡¥ï‡¥®‡µÅ‡¥Ç ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø‡¥Ø‡µÅ‡¥Æ‡¥æ‡¥£‡µç.",
    "‡¥é.‡¥ê ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç": "‡¥é.‡¥ê ‡¥é‡¥®‡µç‡¥®‡µç ‡¥Ö‡µº‡¥§‡µç‡¥•‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡µç Artificial Intelligence ‚Äî ‡¥Ö‡¥§‡¥æ‡¥Ø‡¥§‡µç ‡¥Ø‡¥®‡µç‡¥§‡µç‡¥∞‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥Æ‡¥®‡µÅ‡¥∑‡µç‡¥Ø‡¥¨‡µÅ‡¥¶‡µç‡¥ß‡¥ø‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥Ö‡¥®‡µÅ‡¥ï‡¥∞‡¥£‡¥Ç.",
    "‡¥Ü‡µº‡¥ü‡µç‡¥ü‡¥ø‡¥´‡¥ø‡¥∑‡µç‡¥Ø‡µΩ ‡¥á‡¥®‡µç‡¥±‡¥≤‡¥ø‡¥ú‡µª‡¥∏‡µç ‡¥é‡¥®‡µç‡¥§‡¥æ‡¥£‡µç": "‡¥Ü‡µº‡¥ü‡µç‡¥ü‡¥ø‡¥´‡¥ø‡¥∑‡µç‡¥Ø‡µΩ ‡¥á‡¥®‡µç‡¥±‡¥≤‡¥ø‡¥ú‡µª‡¥∏‡µç ‡¥é‡¥®‡µç‡¥®‡¥§‡µç ‡¥ï‡¥Æ‡µç‡¥™‡µç‡¥Ø‡µÇ‡¥ü‡µç‡¥ü‡¥±‡µÅ‡¥ï‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥Æ‡¥®‡µÅ‡¥∑‡µç‡¥Ø‡¥∞‡µÜ‡¥™‡µç‡¥™‡µã‡¥≤‡µÜ ‡¥ö‡¥ø‡¥®‡µç‡¥§‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥®‡µÅ‡¥Ç ‡¥™‡¥†‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥®‡µÅ‡¥Ç ‡¥§‡µÄ‡¥∞‡µÅ‡¥Æ‡¥æ‡¥®‡¥Æ‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡¥æ‡¥®‡µÅ‡¥Ç ‡¥ï‡¥¥‡¥ø‡¥Ø‡µÅ‡¥®‡µç‡¥® ‡¥ï‡¥¥‡¥ø‡¥µ‡¥æ‡¥£‡µç.",
    "‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç ‡¥™‡¥±‡¥Ø‡µÅ‡¥ï": "‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç ‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥µ‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥Ç, ‡¥û‡¥æ‡µª ‡¥é‡¥°‡µç‡¥Ø‡µÇ ‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥é ‡¥ê, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥é ‡¥ê ‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡¥±‡¥æ‡¥£‡µç. ‡¥™‡¥æ‡¥≤‡¥ï‡µç‡¥ï‡¥æ‡¥ü‡µç ‡¥ú‡¥ø‡¥≤‡µç‡¥≤‡¥æ ‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç ‡¥™‡µç‡¥∞‡¥∏‡¥ø‡¥°‡¥®‡µç‡¥±‡¥æ‡¥Ø ‡¥∂‡µç‡¥∞‡µÄ‡¥Æ‡¥§‡¥ø ‡¥ï‡µÜ. ‡¥¨‡¥ø‡¥®‡µÅ‡¥Æ‡µã‡µæ ‡¥Æ‡¥æ‡¥°‡¥Æ‡¥ø‡¥®‡µÜ, ‡¥∏‡¥Ø‡µª‡¥∏‡µç ‡¥´‡µÜ‡¥Ø‡¥±‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µÅ‡¥Ç YIP 7.0 ‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥±‡µç‡¥±‡µç ‡¥µ‡¥ø‡¥®‡µç‡¥®‡µá‡¥¥‡µç‚Äå‡¥∏‡µç ‡¥é‡¥ï‡µç‡¥∏‡¥ø‡¥¨‡¥ø‡¥∑‡¥®‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥Ü‡¥§‡µç‡¥Æ‡¥æ‡µº‡¥§‡µç‡¥•‡¥Æ‡¥æ‡¥Ø ‡¥Ö‡¥≠‡¥ø‡¥Æ‡¥æ‡¥®‡¥§‡µç‡¥§‡µã‡¥ü‡µÅ‡¥Ç ‡¥∏‡¥®‡µç‡¥§‡µã‡¥∑‡¥§‡µç‡¥§‡µã‡¥ü‡µÅ‡¥Ç ‡¥ï‡µÇ‡¥ü‡¥ø‡¥Ø‡¥æ‡¥£‡µç ‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡¥§‡µç. ‡¥Æ‡¥æ‡¥°‡¥Ç, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡¥æ‡¥®‡µç‡¥®‡¥ø‡¥ß‡µç‡¥Ø‡¥Ç ‡¥û‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥µ‡¥≤‡¥ø‡¥Ø ‡¥ó‡µó‡¥∞‡¥µ‡¥µ‡µÅ‡¥Ç ‡¥∏‡¥®‡µç‡¥§‡µã‡¥∑‡¥µ‡µÅ‡¥Æ‡¥æ‡¥£‡µç. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥™‡µç‡¥∞‡µã‡¥§‡µç‡¥∏‡¥æ‡¥π‡¥®‡¥µ‡µÅ‡¥Ç ‡¥™‡¥ø‡¥®‡µç‡¥§‡µÅ‡¥£‡¥Ø‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡µº‡¥§‡µç‡¥•‡¥ø‡¥ï‡¥≥‡µÜ ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ ‡¥µ‡¥≤‡¥ø‡¥Ø ‡¥∏‡µç‡¥µ‡¥™‡µç‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥ï‡¥æ‡¥£‡¥æ‡¥®‡µÅ‡¥Ç ‡¥â‡¥Ø‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µá‡¥ü‡¥æ‡¥®‡µÅ‡¥Ç ‡¥™‡µç‡¥∞‡¥ö‡µã‡¥¶‡¥®‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ. ‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥Ö‡¥ß‡µç‡¥Ø‡¥æ‡¥™‡¥ï‡¥∞‡µÅ‡¥ü‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡µº‡¥§‡µç‡¥•‡¥ø‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥≠‡¥æ‡¥ó‡¥§‡µç‡¥§‡µÅ‡¥®‡¥ø‡¥®‡µç‡¥®‡µÅ‡¥Ç, ‡¥û‡¥ô‡µç‡¥ô‡µæ ‡¥π‡µÉ‡¥¶‡¥Ø‡¥™‡µÇ‡µº‡¥µ‡µç‡¥µ‡¥Ç ‡¥Æ‡¥æ‡¥°‡¥Æ‡¥ø‡¥®‡µÜ ‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ. ‡¥®‡¥®‡µç‡¥¶‡¥ø.",
    "‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç": "‡¥®‡¥Æ‡¥∏‡µç‡¥ï‡¥æ‡¥∞‡¥Ç ‡¥é‡¥≤‡µç‡¥≤‡¥æ‡¥µ‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥Ç, ‡¥û‡¥æ‡µª ‡¥é‡¥°‡µç‡¥Ø‡µÇ ‡¥¨‡µã‡¥ü‡µç‡¥ü‡µç ‡¥é ‡¥ê, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥é ‡¥ê ‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡¥±‡¥æ‡¥£‡µç. ‡¥™‡¥æ‡¥≤‡¥ï‡µç‡¥ï‡¥æ‡¥ü‡µç ‡¥ú‡¥ø‡¥≤‡µç‡¥≤‡¥æ ‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç ‡¥™‡µç‡¥∞‡¥∏‡¥ø‡¥°‡¥®‡µç‡¥±‡¥æ‡¥Ø ‡¥∂‡µç‡¥∞‡µÄ‡¥Æ‡¥§‡¥ø ‡¥ï‡µÜ. ‡¥¨‡¥ø‡¥®‡µÅ‡¥Æ‡µã‡µæ ‡¥Æ‡¥æ‡¥°‡¥Æ‡¥ø‡¥®‡µÜ, ‡¥∏‡¥Ø‡µª‡¥∏‡µç ‡¥´‡µÜ‡¥Ø‡¥±‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µÅ‡¥Ç YIP 7.0 ‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥±‡µç‡¥±‡µç ‡¥µ‡¥ø‡¥®‡µç‡¥®‡µá‡¥¥‡µç‚Äå‡¥∏‡µç ‡¥é‡¥ï‡µç‡¥∏‡¥ø‡¥¨‡¥ø‡¥∑‡¥®‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µÅ‡¥Ç ‡¥Ü‡¥§‡µç‡¥Æ‡¥æ‡µº‡¥§‡µç‡¥•‡¥Æ‡¥æ‡¥Ø ‡¥Ö‡¥≠‡¥ø‡¥Æ‡¥æ‡¥®‡¥§‡µç‡¥§‡µã‡¥ü‡µÅ‡¥Ç ‡¥∏‡¥®‡µç‡¥§‡µã‡¥∑‡¥§‡µç‡¥§‡µã‡¥ü‡µÅ‡¥Ç ‡¥ï‡µÇ‡¥ü‡¥ø‡¥Ø‡¥æ‡¥£‡µç ‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡¥§‡µç. ‡¥Æ‡¥æ‡¥°‡¥Ç, ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥∏‡¥æ‡¥®‡µç‡¥®‡¥ø‡¥ß‡µç‡¥Ø‡¥Ç ‡¥û‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥µ‡¥≤‡¥ø‡¥Ø ‡¥ó‡µó‡¥∞‡¥µ‡¥µ‡µÅ‡¥Ç ‡¥∏‡¥®‡µç‡¥§‡µã‡¥∑‡¥µ‡µÅ‡¥Æ‡¥æ‡¥£‡µç. ‡¥®‡¥ø‡¥ô‡µç‡¥ô‡¥≥‡µÅ‡¥ü‡µÜ ‡¥™‡µç‡¥∞‡µã‡¥§‡µç‡¥∏‡¥æ‡¥π‡¥®‡¥µ‡µÅ‡¥Ç ‡¥™‡¥ø‡¥®‡µç‡¥§‡µÅ‡¥£‡¥Ø‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡µº‡¥§‡µç‡¥•‡¥ø‡¥ï‡¥≥‡µÜ ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ ‡¥µ‡¥≤‡¥ø‡¥Ø ‡¥∏‡µç‡¥µ‡¥™‡µç‡¥®‡¥ô‡µç‡¥ô‡µæ ‡¥ï‡¥æ‡¥£‡¥æ‡¥®‡µÅ‡¥Ç ‡¥â‡¥Ø‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥®‡µá‡¥ü‡¥æ‡¥®‡µÅ‡¥Ç ‡¥™‡µç‡¥∞‡¥ö‡µã‡¥¶‡¥®‡¥Ç ‡¥®‡µΩ‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ. ‡¥é‡¥≤‡µç‡¥≤‡¥æ ‡¥Ö‡¥ß‡µç‡¥Ø‡¥æ‡¥™‡¥ï‡¥∞‡µÅ‡¥ü‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡µº‡¥§‡µç‡¥•‡¥ø‡¥ï‡¥≥‡µÅ‡¥ü‡µÜ‡¥Ø‡µÅ‡¥Ç ‡¥≠‡¥æ‡¥ó‡¥§‡µç‡¥§‡µÅ‡¥®‡¥ø‡¥®‡µç‡¥®‡µÅ‡¥Ç, ‡¥û‡¥ô‡µç‡¥ô‡µæ ‡¥π‡µÉ‡¥¶‡¥Ø‡¥™‡µÇ‡µº‡¥µ‡µç‡¥µ‡¥Ç ‡¥Æ‡¥æ‡¥°‡¥Æ‡¥ø‡¥®‡µÜ ‡¥∏‡µç‡¥µ‡¥æ‡¥ó‡¥§‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ. ‡¥®‡¥®‡µç‡¥¶‡¥ø."
};

recognition.onresult = (event) => {
    const transcript = event.results[event.results.length - 1][0].transcript.trim();
    console.log('Transcript:', transcript);

    const normalizedTranscript = transcript.toLowerCase();

    if (isMalayalam) {
        if (normalizedTranscript.includes('‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡µº') || normalizedTranscript.includes('teacher')) {
            const question = normalizedTranscript.replace(/‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡µº|teacher/gi, '').trim();
            if (question) {
                if (malayalamResponses[question]) {
                    const responseText = malayalamResponses[question];
                    document.getElementById('responseText').textContent = responseText;
                    speakText(responseText, 'ml-IN');
                } else {
                    document.getElementById('responseText').textContent = `‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ ‡¥ö‡µã‡¥¶‡¥ø‡¥ö‡µç‡¥ö‡µÅ: "${question}"`;
                    fetchContent(question, true);
                }
            } else {
                document.getElementById('responseText').textContent = '"‡¥ü‡µÄ‡¥ö‡µç‡¥ö‡µº" ‡¥é‡¥®‡µç‡¥®‡µç ‡¥™‡¥±‡¥û‡µç‡¥û‡¥§‡¥ø‡¥®‡µç ‡¥∂‡µá‡¥∑‡¥Ç ‡¥í‡¥∞‡µÅ ‡¥ö‡µã‡¥¶‡µç‡¥Ø‡¥Ç ‡¥ö‡µã‡¥¶‡¥ø‡¥ï‡µç‡¥ï‡µÇ.';
            }
        }
    } else {
        if (normalizedTranscript.includes('hey teacher')) {
            const question = normalizedTranscript.replace(/hey teacher/i, '').trim();
            if (question) {
                if (predefinedResponses[question]) {
                    const responseText = predefinedResponses[question];
                    document.getElementById('responseText').textContent = responseText;
                    speakText(responseText, 'en-US');
                } else {
                    document.getElementById('responseText').textContent = `You asked: "${question}"`;
                    fetchContent(question, false);
                }
            } else {
                document.getElementById('responseText').textContent = 'Please ask a question after saying "Hey Teacher".';
            }
        }
    }
};

recognition.onend = () => {
    console.log('Recognition ended, restarting...');
    isRecognitionRunning = false;
    startRecognition();
};

function startRecognition() {
    if (!isRecognitionRunning) {
        recognition.start();
        isRecognitionRunning = true;
    }
}

startRecognition();

// ‚≠ê THIS IS THE KEY CHANGE - Added systemInstruction
function fetchContent(text, isMalayalamQuery) {
    const languageInstruction = isMalayalamQuery 
        ? 'Please respond in Malayalam (‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç).' 
        : 'Please respond in English.';
    
    fetch(endpoint, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            systemInstruction: {
                parts: [
                    {
                        text: `You are Edu Bot AI, a friendly and knowledgeable AI teacher from P.M.S.A.P.T.H.S.S Kakkove ATL Lab. 
                        
Your role:
- You ONLY answer educational questions related to subjects like Math, Science, History, Geography, English, Languages, Technology, and general knowledge suitable for students.
- You explain concepts clearly and in a way that students can understand easily.
- You encourage curiosity and learning.
- Keep responses concise and student-friendly (maximum 13 lines).
- If asked non-educational questions (entertainment, games, personal opinions unrelated to learning), politely say: "I'm sorry, but as an educational assistant, I can only help with questions related to learning and academics. Please ask me something about your studies!"

${languageInstruction}`
                    }
                ]
            },
            contents: [
                {
                    parts: [
                        {
                            text: text
                        }
                    ]
                }
            ]
        })
    })
    .then(response => {
        if (!response.ok) {
            return response.text().then(errorMessage => {
                throw new Error(`HTTP error! Status: ${response.status}, Message: ${errorMessage}`);
            });
        }
        return response.json();
    })
    .then(data => {
        console.log('API Response:', data);

        const candidates = data.candidates || [];
        const responseText = candidates.length > 0 && candidates[0].content && candidates[0].content.parts && candidates[0].content.parts[0] && candidates[0].content.parts[0].text;

        if (responseText) {
            const cleanedResponse = stripMarkdown(responseText);
            document.getElementById('responseText').textContent = cleanedResponse;
            speakText(cleanedResponse, isMalayalamQuery ? 'ml-IN' : 'en-US');
        } else {
            const noResponseMsg = isMalayalamQuery ? 'API ‡¥Ø‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥™‡µç‡¥∞‡¥§‡¥ø‡¥ï‡¥∞‡¥£‡¥Æ‡¥ø‡¥≤‡µç‡¥≤.' : 'No response from API.';
            document.getElementById('responseText').textContent = noResponseMsg;
            startRecognition();
        }
    })
    .catch(error => {
        console.error('Error details:', error);
        const errorMsg = isMalayalamQuery 
            ? `‡¥ï‡µç‡¥∑‡¥Æ‡¥ø‡¥ï‡µç‡¥ï‡¥£‡¥Ç, ‡¥í‡¥∞‡µÅ ‡¥™‡¥ø‡¥∂‡¥ï‡µç ‡¥∏‡¥Ç‡¥≠‡¥µ‡¥ø‡¥ö‡µç‡¥ö‡µÅ: ${error.message}`
            : `Sorry, there was an error: ${error.message}`;
        document.getElementById('responseText').textContent = errorMsg;
        startRecognition();
    });
}

function stripMarkdown(text) {
    return text
        .replace(/\*\*([^\*]+)\*\*/g, '$1')
        .replace(/\*([^\*]+)\*/g, '$1')
        .replace(/(^|\s)#[^\s]+/g, '')
        .replace(/!\[.*?\]\(.*?\)/g, '')
        .replace(/\[.*?\]\(.*?\)/g, '')
        .replace(/`{1,3}.*?`{1,3}/g, '')
        .trim();
}

function speakText(text, lang) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    
    const setVoice = () => {
        const voices = window.speechSynthesis.getVoices();
        
        let selectedVoice;
        if (lang === 'ml-IN') {
            selectedVoice = voices.find(voice => 
                voice.lang === 'ml-IN' && voice.name.toLowerCase().includes('female')
            ) || voices.find(voice => voice.lang === 'ml-IN')
              || voices.find(voice => voice.lang.startsWith('ml'));
        } else {
            selectedVoice = voices.find(voice => 
                voice.lang === 'en-US' && voice.name.toLowerCase().includes('female')
            ) || voices.find(voice => voice.lang === 'en-US');
        }
        
        if (selectedVoice) {
            utterance.voice = selectedVoice;
        }
        
        console.log('Selected voice:', selectedVoice);
    };
    
    setVoice();
    
    if (window.speechSynthesis.onvoiceschanged !== undefined) {
        window.speechSynthesis.onvoiceschanged = setVoice;
    }

    const readTimeLimit = 60000;
    let speakingTimeout;

    utterance.onend = () => {
        console.log('Speech ended.');
        const continueMsg = lang === 'ml-IN' 
            ? '\n‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µÄ‡¥®‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥µ‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç.'
            : '\nYou can read from the screen.';
        document.getElementById('responseText').textContent += continueMsg;
        clearTimeout(speakingTimeout);
        setTimeout(startRecognition, 1000);
    };

    utterance.onerror = (event) => {
        console.error('SpeechSynthesisUtterance.onerror', event);
        clearTimeout(speakingTimeout);
        setTimeout(startRecognition, 1000);
    };

    recognition.stop();
    isRecognitionRunning = false;
    window.speechSynthesis.speak(utterance);

    speakingTimeout = setTimeout(() => {
        window.speechSynthesis.cancel();
        const continueMsg = lang === 'ml-IN' 
            ? '\n‡¥®‡¥ø‡¥ô‡µç‡¥ô‡µæ‡¥ï‡µç‡¥ï‡µç ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µÄ‡¥®‡¥ø‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥µ‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç.'
            : '\nYou can read from the screen.';
        document.getElementById('responseText').textContent += continueMsg;
        setTimeout(startRecognition, 1000);
    }, readTimeLimit);
}

window.speechSynthesis.onvoiceschanged = () => {
    const voices = window.speechSynthesis.getVoices();
    console.log('Available voices:', voices);
};

// Dialog
const dialog = document.getElementById('instructionDialog');
const closeButton = document.getElementById('closeDialogBtn');

dialog.showModal();

closeButton.addEventListener("click", () => {
    dialog.close();
});
</script>
</body>
</html>